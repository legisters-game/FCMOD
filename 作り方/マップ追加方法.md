# ステージ追加方法
複数のアプローチがあります。
* ## Godot内で作ったステージ
  作ったステージを一旦「MOD/(MOD名)/中間ステージ」のようなお好みのフォルダに保存します。(以降このシーンを中間ステージシーンと呼びます)
  当たり判定の設定はこの中間ステージシーンで付けてください。
* ## 3Dソフトで作ったステージ
  <details>
  <summary>表示</summary>
    
  データをglbファイルで書き出します。<br>
  「MOD/(MOD名)/ステージデータ/(ステージ名)」のようなフォルダに保存し、ステージごとに管理できるようにフォルダ構成を行ってください。<br>
  ![glb](../画像/マップ/glb入れる.png)<br>
  続いて「MOD/(MOD名)/ステージデータ/(ステージ名)/メッシュ」、「MOD/(MOD名)/ステージデータ/(ステージ名)/マテリアル」とフォルダを作成し、glbインポート画面(glbファイルダブルクリック)でマテリアルとメッシュのパスを指定して再インポートしてください。<br>
  ![glb](../画像/マップ/glbメッシュパス.png) ![glb](../画像/マップ/glbメッシュ保存.png)<br><br>
  これは何を行っているかと言うと、「glb」ファイルにはテクスチャやマテリアルなどのリソースが入っていて１つのシーンとなって保存されています。このシーンを編集するにはGlbのシーンを継承しなけらばなりません。インスタンスによって継承されたシーンのリソースはゲームのディレクトリには保存されず、glbファイルにあるリソースを読み取っている形になります。万が一glbファイルを再インポートした場合、継承したシーンの変更がリセットされてしまうので、リソースを別途保存しました。<br><br>
  次にglbファイルを継承してシーンを作成します。
  ![glb](../画像/マップ/glb継承.png)<br><br>
  この段階ではまだ当たり判定は存在しません。当たり判定を追加したいメッシュを選択し、<br>
  ![glb](../画像/マップ/メッシュ当たり.png)<br>
  「メッシュ/コリジョン形状を作成」から ![glb](../画像/マップ/メッシュコリジョン.png)<br><br>
  「コリジョンシェイプの配置」を「スタティックボディの子」に変更し、「コリジョンシェイプの型」をお好み(マウスカーソルを添えることでそれぞれの詳細が見れます)で選択して、「作成」してください。<br>
  ![glb](../画像/マップ/メッシュ当たりノード.png)<br><br>これでメッシュに当たり判定を作成することができました。これを当たり判定が欲しいところに全て行ってください。<br>
  ![glb](../画像/マップ/メッシュ当たり追加完了.png)<br><br>
  エンジンで調整中にやっぱりいらないメッシュがあったりするかと思います。継承されたシーンでは移動は可能ですが、消すという動作は行えません。<br>
  ![glb](../画像/マップ/消せない.png)<br><br>
  このシーンを「MOD/(MOD名)/中間ステージ」のようなお好みのフォルダに保存します。(以降このシーンを中間ステージシーンと呼びます)<br>
  シーンを保存すると「継承をクリア」という項目が出てきます。![glb](../画像/マップ/継承クリア.png)<br>
  そうすることでglbファイルとのリンクを切る(Godotで作ったステージになる)ことができます。「継承をクリア」した後、glbファイルを消去することで容量を削減します。<br>
  いらないメッシュノードもこれを行うことで消せるようになります。
   ![glb](../画像/マップ/glb消去.png)<br><br>
  </details>

中間ステージシーンが完成したら「メインリソース/シーン/オブジェクト/インスタンス化素」フォルダにある「マップ必須ノード」シーンを継承して新しいシーンを作成します。<br>
![glb](../画像/マップ/必須継承.png)<br>その中に「中間ステージシーン」を持っていきます。
![glb](../画像/マップ/必須に入れる.png)<br>位置、大きさを調整します。「プレイヤー1」「プレイヤー2」ノードはスポーン地点となります。<br>
![glb](../画像/マップ/必須途中.png)<br>周りが物足りない場合は追加でメッシュをこのシーンに入れます。<br>この段階で「マップシーン」フォルダにこのシーンを保存してしまいましょう。(エラーでクラッシュすると消えてしまうため)<br><br>
背景は「WorldEnvironment」ノードの「environment」プロパティに「新規Environment」で追加することで編集できます。
![glb](../画像/マップ/環境設定.png)詳しい設定は[こちら(まだ翻訳されてません)](https://docs.godotengine.org/ja/4.x/tutorials/3d/environment_and_post_processing.html)を参照してください。<br><br>
## このシーンのルートノード名は「ステージ」のままにして変更しないでください。
「ステージ」ノードで以下のプロパティを変更できます。<br>
![ステージ](../画像/マップ/ステージクラス.png)「ステージ映像」は「AnimationPlayer」ノードをきちんと設定したときのみオンにしてください。<br>
（設定できていないと止まってしまいます）<br><br>
「AnimationPlayer」ノードではキャラの登場モーション前にステージを映すことができます。<br>
「アニメーション」から「新規」で新しいアニメーションを作成してください。(名前はなんでもOK)
![ステージ](../画像/マップ/アニメ.png)<br>
「Camera3D」ノードのキーフレームを以下のようにお好みに打つ<br>
![ステージ](../画像/マップ/カメラ.png)<br>
※カメラは自動で切り替わるようになっています<br><br>
## 重要：これにチェックを入れてください
![ステージ](../画像/マップ/自動.png)　そして「ステージ」ノードの「ステージ映像」プロパティをオンにすることで再生されます。

# 最終チェックです。シーンは「マップシーン」フォルダに保存されていますか？
![ステージ](../画像/マップ/保存パス.png)
 保存名は唯一無二にして他のMODと競合しないようにしてください。


